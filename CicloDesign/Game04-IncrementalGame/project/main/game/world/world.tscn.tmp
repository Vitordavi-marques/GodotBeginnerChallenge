[gd_scene load_steps=18 format=2]

[ext_resource path="res://assets/ui/main_theme.tres" type="Theme" id=1]
[ext_resource path="res://components/ui/ui_button_large/ui_button_large.tscn" type="PackedScene" id=2]
[ext_resource path="res://components/ui/ui_label/ui_label.tscn" type="PackedScene" id=3]
[ext_resource path="res://components/calculator/calculator.tscn" type="PackedScene" id=4]
[ext_resource path="res://assets/ui/components/ui_button_small_normal_style.tres" type="StyleBox" id=5]
[ext_resource path="res://libs/gt_points/gt_points.gd" type="Script" id=6]
[ext_resource path="res://main/game/world/components/world_inventory.gd" type="Script" id=7]
[ext_resource path="res://components/ui/ui_resource_button/ui_resource_button.tscn" type="PackedScene" id=8]
[ext_resource path="res://assets/ui/components/ui_empty_separator.tres" type="StyleBox" id=9]
[ext_resource path="res://libs/gt_formula/gt_formula.gd" type="Script" id=10]
[ext_resource path="res://main/game/world/world.gd" type="Script" id=11]
[ext_resource path="res://scenes/text_window/text_window.tscn" type="PackedScene" id=12]
[ext_resource path="res://components/event/event.gd" type="Script" id=13]
[ext_resource path="res://scenes/event_popups/visitor_event_popup/visitor_event_popup.tscn" type="PackedScene" id=14]
[ext_resource path="res://components/rng/rng.tscn" type="PackedScene" id=15]

[sub_resource type="StyleBoxFlat" id=1]
bg_color = Color( 0, 0, 0, 1 )
border_width_left = 1
border_width_top = 1
border_width_right = 1
border_width_bottom = 1
border_color = Color( 0, 0, 0, 1 )
border_blend = true

[sub_resource type="StyleBoxFlat" id=2]
bg_color = Color( 1, 1, 1, 0 )
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color( 0, 0, 0, 1 )

[node name="World" type="Node2D"]
script = ExtResource( 11 )
__meta__ = {
"_edit_lock_": true
}

[node name="DebugTimer" type="Timer" parent="."]
autostart = true

[node name="Inventory" type="Node" parent="."]
script = ExtResource( 7 )

[node name="Resources" type="Node" parent="Inventory"]

[node name="wood" type="Node" parent="Inventory/Resources"]
script = ExtResource( 6 )

[node name="huts" type="Node" parent="Inventory/Resources"]
script = ExtResource( 6 )

[node name="villagers" type="Node" parent="Inventory/Resources"]
script = ExtResource( 6 )

[node name="Multipliers" type="Node" parent="Inventory"]

[node name="wood_per_click" type="Node" parent="Inventory/Multipliers"]
script = ExtResource( 6 )
initial_points = 10

[node name="calculator" parent="Inventory/Multipliers/wood_per_click" instance=ExtResource( 4 )]
node_a_path = NodePath("..")

[node name="Costs" type="Node" parent="Inventory"]

[node name="hut_cost" type="Node" parent="Inventory/Costs"]
script = ExtResource( 6 )
initial_points = 10

[node name="can_afford" type="Node" parent="Inventory/Costs/hut_cost"]
script = ExtResource( 10 )
node_a_path = NodePath("../../../Resources/wood")
node_b_path = NodePath("..")
formula_type = 3
invert_result = true

[node name="perform_pay" parent="Inventory/Costs/hut_cost" instance=ExtResource( 4 )]
node_a_path = NodePath("../../../Resources/wood")
node_b_path = NodePath("..")
operator = 3

[node name="Unlocks" type="Node" parent="Inventory"]

[node name="unlock_build_tab" type="Node" parent="Inventory/Unlocks"]
script = ExtResource( 10 )
node_a_path = NodePath("../../Resources/wood")
node_b_path = NodePath("wood_required")
formula_type = 3

[node name="wood_required" type="Node" parent="Inventory/Unlocks/unlock_build_tab"]
script = ExtResource( 6 )
initial_points = 20

[node name="unlock_village_panel" type="Node" parent="Inventory/Unlocks"]
script = ExtResource( 10 )
node_a_path = NodePath("../../Resources/huts")
node_b_path = NodePath("huts_required")
formula_type = 3

[node name="huts_required" type="Node" parent="Inventory/Unlocks/unlock_village_panel"]
script = ExtResource( 6 )
initial_points = 1

[node name="Events" type="Node" parent="Inventory"]

[node name="first_visitor" type="Node" parent="Inventory/Events"]
script = ExtResource( 10 )
node_a_path = NodePath("../../Resources/huts")
node_b_path = NodePath("huts_required")
formula_type = 3

[node name="huts_required" type="Node" parent="Inventory/Events/first_visitor"]
script = ExtResource( 6 )
initial_points = 2

[node name="Events" type="Node" parent="."]

[node name="IntroText" type="Node" parent="Events"]

[node name="1" type="Node" parent="Events/IntroText"]
script = ExtResource( 13 )
timed_event = true
time_to_effect = 1.0

[node name="2" type="Node" parent="Events/IntroText"]
script = ExtResource( 13 )
timed_event = true
time_to_effect = 3.0

[node name="3" type="Node" parent="Events/IntroText"]
script = ExtResource( 13 )
timed_event = true
time_to_effect = 5.0

[node name="4" type="Node" parent="Events/IntroText"]
script = ExtResource( 13 )
timed_event = true
time_to_effect = 7.0

[node name="5" type="Node" parent="Events/IntroText"]
script = ExtResource( 13 )
timed_event = true
time_to_effect = 9.0

[node name="6" type="Node" parent="Events/IntroText"]
script = ExtResource( 13 )
timed_event = true
time_to_effect = 11.0

[node name="Visitors" type="Node" parent="Events"]

[node name="FirstVisitorEvent" type="Node" parent="Events/Visitors"]
script = ExtResource( 13 )

[node name="villager_rand" parent="Events/Visitors/FirstVisitorEvent" instance=ExtResource( 15 )]
random_numbers = [ 1, 1, 2, 2, 3 ]

[node name="Popus" type="CanvasLayer" parent="Events"]
layer = 2

[node name="VisitorEventPopup" parent="Events/Popus" instance=ExtResource( 14 )]

[node name="UI" type="CanvasLayer" parent="."]

[node name="color_background" type="ColorRect" parent="UI"]
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="root" type="MarginContainer" parent="UI"]
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 288.0
margin_top = 20.0
margin_right = -288.0
margin_bottom = -20.0
theme = ExtResource( 1 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="row" type="HBoxContainer" parent="UI/root"]
margin_right = 704.0
margin_bottom = 680.0
custom_constants/separation = 10
alignment = 1
__meta__ = {
"_edit_lock_": true
}

[node name="text_window" parent="UI/root/row" instance=ExtResource( 12 )]

[node name="main_window" type="VBoxContainer" parent="UI/root/row"]
margin_left = 238.0
margin_right = 466.0
margin_bottom = 680.0
size_flags_horizontal = 3
__meta__ = {
"_edit_lock_": true
}

[node name="tab_buttons" type="HBoxContainer" parent="UI/root/row/main_window"]
margin_right = 228.0
__meta__ = {
"_edit_lock_": true
}

[node name="tab_gather" parent="UI/root/row/main_window/tab_buttons" instance=ExtResource( 2 )]
visible = false
margin_right = 132.0
margin_bottom = 32.0
text = "TAB_GATHER"

[node name="separator" type="VSeparator" parent="UI/root/row/main_window/tab_buttons"]
visible = false
margin_left = 136.0
margin_top = 6.0
margin_right = 140.0
margin_bottom = 26.0
rect_min_size = Vector2( 0, 20 )
size_flags_horizontal = 0
size_flags_vertical = 4
custom_styles/separator = SubResource( 1 )
__meta__ = {
"_edit_lock_": true
}

[node name="tab_build" parent="UI/root/row/main_window/tab_buttons" instance=ExtResource( 2 )]
visible = false
margin_left = 144.0
margin_right = 264.0
margin_bottom = 32.0
disabled = true
text = "TAB_BUILD"

[node name="tab_container" type="TabContainer" parent="UI/root/row/main_window"]
visible = false
margin_top = 4.0
margin_right = 228.0
margin_bottom = 680.0
size_flags_horizontal = 3
size_flags_vertical = 3
tab_align = 0
__meta__ = {
"_edit_lock_": true
}

[node name="Gather" type="MarginContainer" parent="UI/root/row/main_window/tab_container"]
anchor_right = 1.0
anchor_bottom = 1.0
margin_top = 26.0
__meta__ = {
"_edit_lock_": true
}

[node name="buttons" type="VBoxContainer" parent="UI/root/row/main_window/tab_container/Gather"]
margin_right = 188.0
margin_bottom = 650.0
size_flags_horizontal = 0
size_flags_vertical = 3
__meta__ = {
"_edit_lock_": true
}

[node name="gather_wood" parent="UI/root/row/main_window/tab_container/Gather/buttons" instance=ExtResource( 8 )]
margin_right = 188.0
margin_bottom = 29.0
custom_styles/pressed = ExtResource( 5 )
text = "BUTTON_GATHER_WOOD"
cooldown_time = 10.0

[node name="Build" type="MarginContainer" parent="UI/root/row/main_window/tab_container"]
visible = false
anchor_right = 1.0
anchor_bottom = 1.0
margin_top = 26.0

[node name="buttons" type="VBoxContainer" parent="UI/root/row/main_window/tab_container/Build"]
margin_right = 168.0
margin_bottom = 650.0
size_flags_horizontal = 0
size_flags_vertical = 3
__meta__ = {
"_edit_lock_": true
}

[node name="build_hut" parent="UI/root/row/main_window/tab_container/Build/buttons" instance=ExtResource( 8 )]
margin_right = 98.0
margin_bottom = 29.0
hint_tooltip = "WOOD_RESOURCE          20"
custom_styles/pressed = ExtResource( 5 )
text = "BUTTON_BUILD_HUT"
cooldown_time = 0.0

[node name="resource_window" type="VBoxContainer" parent="UI/root/row"]
margin_left = 476.0
margin_right = 704.0
margin_bottom = 680.0
size_flags_horizontal = 3
__meta__ = {
"_edit_lock_": true
}

[node name="empty_space" type="VSeparator" parent="UI/root/row/resource_window"]
margin_right = 228.0
margin_bottom = 64.0
rect_min_size = Vector2( 0, 64 )
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="resources" type="MarginContainer" parent="UI/root/row/resource_window"]
visible = false
margin_top = 68.0
margin_right = 228.0
margin_bottom = 125.0
__meta__ = {
"_edit_lock_": true
}

[node name="panel" type="PanelContainer" parent="UI/root/row/resource_window/resources"]
margin_right = 228.0
margin_bottom = 57.0
custom_styles/panel = SubResource( 2 )
__meta__ = {
"_edit_lock_": true
}

[node name="items" type="VBoxContainer" parent="UI/root/row/resource_window/resources/panel"]
margin_left = 2.0
margin_top = 2.0
margin_right = 226.0
margin_bottom = 55.0
alignment = 1
__meta__ = {
"_edit_lock_": true
}

[node name="title" parent="UI/root/row/resource_window/resources/panel/items" instance=ExtResource( 3 )]
margin_right = 224.0
margin_bottom = 21.0
text = "PANEL_RESOURCES"
align = 1

[node name="empty_space" type="VSeparator" parent="UI/root/row/resource_window/resources/panel/items"]
margin_top = 25.0
margin_right = 224.0
margin_bottom = 28.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="wood" type="HBoxContainer" parent="UI/root/row/resource_window/resources/panel/items"]
margin_top = 32.0
margin_right = 224.0
margin_bottom = 53.0
__meta__ = {
"_edit_lock_": true
}

[node name="empty_space" type="VSeparator" parent="UI/root/row/resource_window/resources/panel/items/wood"]
margin_right = 4.0
margin_bottom = 21.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="title" parent="UI/root/row/resource_window/resources/panel/items/wood" instance=ExtResource( 3 )]
margin_left = 8.0
margin_right = 138.0
margin_bottom = 21.0
text = "RESOURCE_WOOD"

[node name="empty" type="Label" parent="UI/root/row/resource_window/resources/panel/items/wood"]
margin_left = 142.0
margin_top = 3.0
margin_right = 202.0
margin_bottom = 17.0
size_flags_horizontal = 3
__meta__ = {
"_edit_lock_": true
}

[node name="amount" parent="UI/root/row/resource_window/resources/panel/items/wood" instance=ExtResource( 3 )]
margin_left = 206.0
margin_right = 216.0
margin_bottom = 21.0
text = "0"
pattern_text = "%s"

[node name="empty_space2" type="VSeparator" parent="UI/root/row/resource_window/resources/panel/items/wood"]
margin_left = 220.0
margin_right = 224.0
margin_bottom = 21.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="empty_space_2" type="VSeparator" parent="UI/root/row/resource_window"]
margin_top = 68.0
margin_right = 228.0
margin_bottom = 78.0
rect_min_size = Vector2( 0, 10 )
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="village" type="MarginContainer" parent="UI/root/row/resource_window"]
visible = false
margin_top = 143.0
margin_right = 228.0
margin_bottom = 200.0
__meta__ = {
"_edit_lock_": true
}

[node name="panel" type="PanelContainer" parent="UI/root/row/resource_window/village"]
margin_right = 228.0
margin_bottom = 57.0
custom_styles/panel = SubResource( 2 )
__meta__ = {
"_edit_lock_": true
}

[node name="items" type="VBoxContainer" parent="UI/root/row/resource_window/village/panel"]
margin_left = 2.0
margin_top = 2.0
margin_right = 226.0
margin_bottom = 55.0
alignment = 1
__meta__ = {
"_edit_lock_": true
}

[node name="title" parent="UI/root/row/resource_window/village/panel/items" instance=ExtResource( 3 )]
margin_right = 224.0
margin_bottom = 21.0
text = "PANEL_VILLAGE"
align = 1

[node name="empty_space" type="VSeparator" parent="UI/root/row/resource_window/village/panel/items"]
margin_top = 25.0
margin_right = 224.0
margin_bottom = 28.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="huts" type="HBoxContainer" parent="UI/root/row/resource_window/village/panel/items"]
margin_top = 32.0
margin_right = 224.0
margin_bottom = 53.0
__meta__ = {
"_edit_lock_": true
}

[node name="empty_space" type="VSeparator" parent="UI/root/row/resource_window/village/panel/items/huts"]
margin_right = 4.0
margin_bottom = 21.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="title" parent="UI/root/row/resource_window/village/panel/items/huts" instance=ExtResource( 3 )]
margin_left = 8.0
margin_right = 128.0
margin_bottom = 21.0
text = "RESOURCE_HUT"

[node name="empty" type="Label" parent="UI/root/row/resource_window/village/panel/items/huts"]
margin_left = 132.0
margin_top = 3.0
margin_right = 202.0
margin_bottom = 17.0
size_flags_horizontal = 3
__meta__ = {
"_edit_lock_": true
}

[node name="amount" parent="UI/root/row/resource_window/village/panel/items/huts" instance=ExtResource( 3 )]
margin_left = 206.0
margin_right = 216.0
margin_bottom = 21.0
text = "0"
pattern_text = "%s"

[node name="empty_space2" type="VSeparator" parent="UI/root/row/resource_window/village/panel/items/huts"]
margin_left = 220.0
margin_right = 224.0
margin_bottom = 21.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="villagers" type="HBoxContainer" parent="UI/root/row/resource_window/village/panel/items"]
visible = false
margin_top = 32.0
margin_right = 224.0
margin_bottom = 53.0
__meta__ = {
"_edit_lock_": true
}

[node name="empty_space" type="VSeparator" parent="UI/root/row/resource_window/village/panel/items/villagers"]
margin_right = 4.0
margin_bottom = 21.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="title" parent="UI/root/row/resource_window/village/panel/items/villagers" instance=ExtResource( 3 )]
margin_left = 8.0
margin_right = 128.0
margin_bottom = 21.0
text = "RESOURCE_VILLAGER"

[node name="empty" type="Label" parent="UI/root/row/resource_window/village/panel/items/villagers"]
margin_left = 132.0
margin_top = 3.0
margin_right = 202.0
margin_bottom = 17.0
size_flags_horizontal = 3
__meta__ = {
"_edit_lock_": true
}

[node name="amount" parent="UI/root/row/resource_window/village/panel/items/villagers" instance=ExtResource( 3 )]
margin_left = 206.0
margin_right = 216.0
margin_bottom = 21.0
text = "0"
pattern_text = "%s"

[node name="empty_space2" type="VSeparator" parent="UI/root/row/resource_window/village/panel/items/villagers"]
margin_left = 220.0
margin_right = 224.0
margin_bottom = 21.0
custom_styles/separator = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[connection signal="timeout" from="DebugTimer" to="." method="_on_DebugTimer_timeout"]
[connection signal="resource_points_updated" from="Inventory" to="Inventory/Costs/hut_cost/can_afford" method="validate"]
[connection signal="resource_points_updated" from="Inventory" to="Inventory/Events/first_visitor" method="validate"]
[connection signal="resource_points_updated" from="Inventory" to="Inventory/Unlocks/unlock_build_tab" method="validate"]
[connection signal="resource_points_updated" from="Inventory" to="Inventory/Unlocks/unlock_village_panel" method="validate"]
[connection signal="points_updated" from="Inventory/Resources/wood" to="UI/root/row/resource_window/resources/panel/items/wood/amount" method="apply_text_simple"]
[connection signal="points_updated" from="Inventory/Resources/wood" to="Inventory" method="_on_points_updated"]
[connection signal="points_updated" from="Inventory/Resources/huts" to="UI/root/row/resource_window/village/panel/items/huts/amount" method="apply_text_simple"]
[connection signal="points_updated" from="Inventory/Resources/huts" to="Inventory" method="_on_points_updated"]
[connection signal="gained_points" from="Inventory/Resources/villagers" to="UI/root/row/resource_window/village/panel/items/villagers" method="set_visible" binds= [ true ]]
[connection signal="points_updated" from="Inventory/Resources/villagers" to="UI/root/row/resource_window/village/panel/items/villagers/amount" method="apply_text_simple"]
[connection signal="points_updated" from="Inventory/Resources/villagers" to="Inventory" method="_on_points_updated"]
[connection signal="result" from="Inventory/Multipliers/wood_per_click/calculator" to="Inventory/Resources/wood" method="gain_points"]
[connection signal="result" from="Inventory/Costs/hut_cost/can_afford" to="UI/root/row/main_window/tab_container/Build/buttons/build_hut" method="set_disabled"]
[connection signal="calculated" from="Inventory/Costs/hut_cost/perform_pay" to="Inventory/Resources/huts" method="gain_points"]
[connection signal="result" from="Inventory/Costs/hut_cost/perform_pay" to="Inventory/Resources/wood" method="set_points"]
[connection signal="succeded" from="Inventory/Unlocks/unlock_build_tab" to="UI/root/row/main_window/tab_buttons/separator" method="set_visible" binds= [ true ]]
[connection signal="succeded" from="Inventory/Unlocks/unlock_build_tab" to="UI/root/row/main_window/tab_buttons/tab_build" method="set_visible" binds= [ true ]]
[connection signal="succeded" from="Inventory/Unlocks/unlock_build_tab" to="UI/root/row/main_window/tab_buttons/tab_build" method="set_disabled" binds= [ false ]]
[connection signal="succeded" from="Inventory/Unlocks/unlock_village_panel" to="UI/root/row/resource_window/village" method="set_visible" binds= [ true ]]
[connection signal="succeded" from="Inventory/Events/first_visitor" to="Events/Visitors/FirstVisitorEvent" method="trigger"]
[connection signal="effect" from="Events/IntroText/1" to="UI/root/row/text_window" method="create_text" binds= [ "TEXT_INTRO_1" ]]
[connection signal="effect" from="Events/IntroText/2" to="UI/root/row/text_window" method="create_text" binds= [ "TEXT_INTRO_2" ]]
[connection signal="effect" from="Events/IntroText/3" to="UI/root/row/text_window" method="create_text" binds= [ "TEXT_INTRO_3" ]]
[connection signal="effect" from="Events/IntroText/4" to="UI/root/row/text_window" method="create_text" binds= [ "TEXT_INTRO_4" ]]
[connection signal="effect" from="Events/IntroText/5" to="UI/root/row/text_window" method="create_text" binds= [ "TEXT_INTRO_5" ]]
[connection signal="effect" from="Events/IntroText/6" to="UI/root/row/resource_window/resources" method="set_visible" binds= [ true ]]
[connection signal="effect" from="Events/IntroText/6" to="UI/root/row/main_window/tab_buttons/tab_gather" method="set_visible" binds= [ true ]]
[connection signal="effect" from="Events/IntroText/6" to="UI/root/row/main_window/tab_container" method="set_visible" binds= [ true ]]
[connection signal="random_number" from="Events/Visitors/FirstVisitorEvent/villager_rand" to="Inventory/Resources/villagers" method="gain_points"]
[connection signal="pressed" from="UI/root/row/main_window/tab_buttons/tab_gather" to="UI/root/row/main_window/tab_container" method="set_current_tab" binds= [ 0 ]]
[connection signal="pressed" from="UI/root/row/main_window/tab_buttons/tab_build" to="UI/root/row/main_window/tab_container" method="set_current_tab" binds= [ 1 ]]
[connection signal="collect" from="UI/root/row/main_window/tab_container/Gather/buttons/gather_wood" to="Inventory/Multipliers/wood_per_click/calculator" method="calculate"]
[connection signal="collect" from="UI/root/row/main_window/tab_container/Build/buttons/build_hut" to="Inventory/Costs/hut_cost/perform_pay" method="calculate"]
